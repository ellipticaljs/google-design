!function(e,t){"undefined"!=typeof module&&module.exports?module.exports=t(require("elliptical-utils"),require("elliptical-class"),require("dustjs"),require("elliptical-dust-helpers")):"function"==typeof define&&define.amd?define(["elliptical-utils","elliptical-class","dustjs","elliptical-dust-helpers"],t):(e.elliptical.$Template=t(e.elliptical.utils,e.elliptical.Class,e.dust,e.dust.helpers),e.returnExports=e.elliptical.$Template)}(this,function(e,t,r,o){function i(e,t){var r=f(e._root);return n(r,t)}function n(e,t){for(var r=t.split("."),o=0;o<r.length;o++)e+="/"+r[o];return e+=".html"}function c(e,t,r,o){$.get(e).done(function(e){var i=t.compile(e,r);t.loadSource(i),o(null,e)}).fail(function(){o(new Error("Error: cannot find "+r+" in views folder"),null)})}function s(e,t,r){var o=i(e,t);c(o,e,t,r)}function l(e,t,r){var o=n("",t);c(o,e,t,r)}function a(e,t,r,o,i){var n=f(e.root),c=n+"/"+t+"/"+r+".html",s=t+"."+r,l=e.$provider;$.get(c,function(e){if(e){var t=l.compile(e,s);l.loadSource(t),l.render(s,o,i)}else i(new Error("Error: Controller View does not exist"),null)})}function u(e,t,r,o){var i=e.$provider,n=i.cache;b.isEmpty(n)?d(e.model,e.$store,i,e.api,function(){i.render(t,r,o)}):i.render(t,r,o)}function d(e,t,o,i,n){if(t)t.getAll(e,function(e,t){for(var o=0,i=t.length;i>o;o++){var c=JSON.parse(t[o]);r.loadSource(c)}n&&n()});else var c=h,s=0,l=setInterval(function(){var e=o.cache;b.isEmpty(e)?(s++,s>c&&n&&n()):(clearInterval(l),n&&n())},p)}function f(e){return"/"===_.lastChar(e)?_.trimLastChar(e):e}var p=250,h=5,v="/app/views",b=e.object,_=e.string,m=e.network;r.optimizers.format=function(e,t){return t},r._root=v,r.onLoad=function(e,t){if(e.indexOf(".")>-1)s(r,e,t);else{var o=new Error("Partial Not Found: "+e);t(o,null)}};var j;return j=t.extend({_data:{},_$store:null,get $store(){return this._$store},set $store(e){this._$store=e},_base:{server:"base",client:"base-client"},get base(){return this._base},set base(e){this._base=e},_$provider:r,get $provider(){return this._$provider},set $provider(e){this._$provider=e,this._$provider._root=this._root},compile:r.compile,cache:r.cache,_model:"template",get model(){return this._model},set model(e){this._model=e},_api:"/api/template",get api(){return this._api},set api(e){this._api=e},_root:v,get root(){return this._root},set root(e){this._root=e,this._$provider._root=e},getBase:function(){return m.isBrowser()?this.base.client:this.base.server},setRoot:function(e){this.root=e,this._root=e,this._$provider._root=e},render:function(e,t,r){if(!e)return void console.warn("warning: cannot render null template");var o=this.$provider,i=o.cache,n=!1;n=i?b.isEmpty(i):!0,!n&&i[void 0!==e]?o.render(e,t,r):"object"==typeof e?this._renderTemplateObjectByControllerView(n,e,t,r):e.indexOf(".")>-1?this._renderTemplateByPathDotHierarchy(e,t,r):u(this,e,t,r)},setBrowserGlobal:function(){"undefined"!=typeof window&&(window.dust=this.$provider)},_renderTemplateObjectByControllerView:function(e,t,r,o){var i=this.$provider,n=i.cache,c=t.name.toLowerCase(),s=t.view.toLowerCase(),l=c+"."+s;e?a(this,c,s,r,o):n[l]?i.render(l,r,o):a(this,c,s,r,o)},_renderTemplateByPathDotHierarchy:function(e,t,r){var o=this,i=this.$provider;s(i,e,function(n,c){n?o._onRenderError(e,t,r):i.render(e,t,r)})},_onRenderError:function(e,t,r){var o=this.$provider;l(o,e,function(i,n){if(i)throw new Error(i);o.render(e,t,r)})}},{init:function(e){e&&(this.constructor._data.base=!0),this.root=this.constructor.root},render:function(e,t,r){if(this.constructor._data.base){var o={render:this.constructor.getBase()},i=this.constructor.$provider.makeBase(o);t=i.push(t)}this.constructor.render(e,t,r)}})});