function enteredOrExited(t){return t===Movement.ENTERED||t===Movement.EXITED}function escapeQuotes(t){return'"'+t.replace(/"/,'\\"')+'"'}function validateAttribute(t){if("string"!=typeof t)throw Error("Invalid request opion. attribute must be a non-zero length string.");if(t=t.trim(),!t)throw Error("Invalid request opion. attribute must be a non-zero length string.");if(!t.match(attributeFilterPattern))throw Error("Invalid request option. invalid attribute name: "+t);return t}function validateElementAttributes(t){if(!t.trim().length)throw Error("Invalid request option: elementAttributes must contain at least one attribute.");for(var e={},r={},a=t.split(/\s+/),i=0;i<a.length;i++){var n=a[i];if(n){var n=validateAttribute(n),o=n.toLowerCase();if(e[o])throw Error("Invalid request option: observing multiple case variations of the same attribute is not supported.");r[n]=!0,e[o]=!0}}return Object.keys(r)}function elementFilterAttributes(t){var e={};return t.forEach(function(t){t.qualifiers.forEach(function(t){e[t.attrName]=!0})}),Object.keys(e)}var __extends=this.__extends||function(t,e){function r(){this.constructor=t}for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a]);r.prototype=e.prototype,t.prototype=new r},MutationObserverCtor;if(MutationObserverCtor="undefined"!=typeof WebKitMutationObserver?WebKitMutationObserver:MutationObserver,void 0===MutationObserverCtor)throw console.error("DOM Mutation Observers are required."),console.error("https://developer.mozilla.org/en-US/docs/DOM/MutationObserver"),Error("DOM Mutation Observers are required");var NodeMap=function(){function t(){this.nodes=[],this.values=[]}return t.prototype.isIndex=function(t){return+t===t>>>0},t.prototype.nodeId=function(e){var r=e[t.ID_PROP];return r||(r=e[t.ID_PROP]=t.nextId_++),r},t.prototype.set=function(t,e){var r=this.nodeId(t);this.nodes[r]=t,this.values[r]=e},t.prototype.get=function(t){var e=this.nodeId(t);return this.values[e]},t.prototype.has=function(t){return this.nodeId(t)in this.nodes},t.prototype["delete"]=function(t){var e=this.nodeId(t);delete this.nodes[e],this.values[e]=void 0},t.prototype.keys=function(){var t=[];for(var e in this.nodes)this.isIndex(e)&&t.push(this.nodes[e]);return t},t.ID_PROP="__mutation_summary_node_map_id__",t.nextId_=1,t}(),Movement;!function(t){t[t.STAYED_OUT=0]="STAYED_OUT",t[t.ENTERED=1]="ENTERED",t[t.STAYED_IN=2]="STAYED_IN",t[t.REPARENTED=3]="REPARENTED",t[t.REORDERED=4]="REORDERED",t[t.EXITED=5]="EXITED"}(Movement||(Movement={}));var NodeChange=function(){function t(t,e,r,a,i,n,o,s){void 0===e&&(e=!1),void 0===r&&(r=!1),void 0===a&&(a=!1),void 0===i&&(i=null),void 0===n&&(n=!1),void 0===o&&(o=null),void 0===s&&(s=null),this.node=t,this.childList=e,this.attributes=r,this.characterData=a,this.oldParentNode=i,this.added=n,this.attributeOldValues=o,this.characterDataOldValue=s,this.isCaseInsensitive=this.node.nodeType===Node.ELEMENT_NODE&&this.node instanceof HTMLElement&&this.node.ownerDocument instanceof HTMLDocument}return t.prototype.getAttributeOldValue=function(t){return this.attributeOldValues?(this.isCaseInsensitive&&(t=t.toLowerCase()),this.attributeOldValues[t]):void 0},t.prototype.getAttributeNamesMutated=function(){var t=[];if(!this.attributeOldValues)return t;for(var e in this.attributeOldValues)t.push(e);return t},t.prototype.attributeMutated=function(t,e){this.attributes=!0,this.attributeOldValues=this.attributeOldValues||{},t in this.attributeOldValues||(this.attributeOldValues[t]=e)},t.prototype.characterDataMutated=function(t){this.characterData||(this.characterData=!0,this.characterDataOldValue=t)},t.prototype.removedFromParent=function(t){this.childList=!0,this.added||this.oldParentNode?this.added=!1:this.oldParentNode=t},t.prototype.insertedIntoParent=function(){this.childList=!0,this.added=!0},t.prototype.getOldParent=function(){if(this.childList){if(this.oldParentNode)return this.oldParentNode;if(this.added)return null}return this.node.parentNode},t}(),ChildListChange=function(){function t(){this.added=new NodeMap,this.removed=new NodeMap,this.maybeMoved=new NodeMap,this.oldPrevious=new NodeMap,this.moved=void 0}return t}(),TreeChanges=function(t){function e(e,r){t.call(this),this.rootNode=e,this.reachableCache=void 0,this.wasReachableCache=void 0,this.anyParentsChanged=!1,this.anyAttributesChanged=!1,this.anyCharacterDataChanged=!1;for(var a=0;a<r.length;a++){var i=r[a];switch(i.type){case"childList":this.anyParentsChanged=!0;for(var n=0;n<i.removedNodes.length;n++){var o=i.removedNodes[n];this.getChange(o).removedFromParent(i.target)}for(var n=0;n<i.addedNodes.length;n++){var o=i.addedNodes[n];this.getChange(o).insertedIntoParent()}break;case"attributes":this.anyAttributesChanged=!0;var s=this.getChange(i.target);s.attributeMutated(i.attributeName,i.oldValue);break;case"characterData":this.anyCharacterDataChanged=!0;var s=this.getChange(i.target);s.characterDataMutated(i.oldValue)}}}return __extends(e,t),e.prototype.getChange=function(t){var e=this.get(t);return e||(e=new NodeChange(t),this.set(t,e)),e},e.prototype.getOldParent=function(t){var e=this.get(t);return e?e.getOldParent():t.parentNode},e.prototype.getIsReachable=function(t){if(t===this.rootNode)return!0;if(!t)return!1;this.reachableCache=this.reachableCache||new NodeMap;var e=this.reachableCache.get(t);return void 0===e&&(e=this.getIsReachable(t.parentNode),this.reachableCache.set(t,e)),e},e.prototype.getWasReachable=function(t){if(t===this.rootNode)return!0;if(!t)return!1;this.wasReachableCache=this.wasReachableCache||new NodeMap;var e=this.wasReachableCache.get(t);return void 0===e&&(e=this.getWasReachable(this.getOldParent(t)),this.wasReachableCache.set(t,e)),e},e.prototype.reachabilityChange=function(t){return this.getIsReachable(t)?this.getWasReachable(t)?Movement.STAYED_IN:Movement.ENTERED:this.getWasReachable(t)?Movement.EXITED:Movement.STAYED_OUT},e}(NodeMap),MutationProjection=function(){function t(t,e,r,a,i){this.rootNode=t,this.mutations=e,this.selectors=r,this.calcReordered=a,this.calcOldPreviousSibling=i,this.treeChanges=new TreeChanges(t,e),this.entered=[],this.exited=[],this.stayedIn=new NodeMap,this.visited=new NodeMap,this.childListChangeMap=void 0,this.characterDataOnly=void 0,this.matchCache=void 0,this.processMutations()}return t.prototype.processMutations=function(){if(this.treeChanges.anyParentsChanged||this.treeChanges.anyAttributesChanged)for(var t=this.treeChanges.keys(),e=0;e<t.length;e++)this.visitNode(t[e],void 0)},t.prototype.visitNode=function(t,e){if(!this.visited.has(t)){this.visited.set(t,!0);var r=this.treeChanges.get(t),a=e;if((r&&r.childList||void 0==a)&&(a=this.treeChanges.reachabilityChange(t)),a!==Movement.STAYED_OUT){if(this.matchabilityChange(t),a===Movement.ENTERED)this.entered.push(t);else if(a===Movement.EXITED)this.exited.push(t),this.ensureHasOldPreviousSiblingIfNeeded(t);else if(a===Movement.STAYED_IN){var i=Movement.STAYED_IN;r&&r.childList&&(r.oldParentNode!==t.parentNode?(i=Movement.REPARENTED,this.ensureHasOldPreviousSiblingIfNeeded(t)):this.calcReordered&&this.wasReordered(t)&&(i=Movement.REORDERED)),this.stayedIn.set(t,i)}if(a!==Movement.STAYED_IN)for(var n=t.firstChild;n;n=n.nextSibling)this.visitNode(n,a)}}},t.prototype.ensureHasOldPreviousSiblingIfNeeded=function(t){if(this.calcOldPreviousSibling){this.processChildlistChanges();var e=t.parentNode,r=this.treeChanges.get(t);r&&r.oldParentNode&&(e=r.oldParentNode);var a=this.childListChangeMap.get(e);a||(a=new ChildListChange,this.childListChangeMap.set(e,a)),a.oldPrevious.has(t)||a.oldPrevious.set(t,t.previousSibling)}},t.prototype.getChanged=function(t,e,r){this.selectors=e,this.characterDataOnly=r;for(var a=0;a<this.entered.length;a++){var i=this.entered[a],n=this.matchabilityChange(i);(n===Movement.ENTERED||n===Movement.STAYED_IN)&&t.added.push(i)}for(var o=this.stayedIn.keys(),a=0;a<o.length;a++){var i=o[a],n=this.matchabilityChange(i);if(n===Movement.ENTERED)t.added.push(i);else if(n===Movement.EXITED)t.removed.push(i);else if(n===Movement.STAYED_IN&&(t.reparented||t.reordered)){var s=this.stayedIn.get(i);t.reparented&&s===Movement.REPARENTED?t.reparented.push(i):t.reordered&&s===Movement.REORDERED&&t.reordered.push(i)}}for(var a=0;a<this.exited.length;a++){var i=this.exited[a],n=this.matchabilityChange(i);(n===Movement.EXITED||n===Movement.STAYED_IN)&&t.removed.push(i)}},t.prototype.getOldParentNode=function(t){var e=this.treeChanges.get(t);if(e&&e.childList)return e.oldParentNode?e.oldParentNode:null;var r=this.treeChanges.reachabilityChange(t);if(r===Movement.STAYED_OUT||r===Movement.ENTERED)throw Error("getOldParentNode requested on invalid node.");return t.parentNode},t.prototype.getOldPreviousSibling=function(t){var e=t.parentNode,r=this.treeChanges.get(t);r&&r.oldParentNode&&(e=r.oldParentNode);var a=this.childListChangeMap.get(e);if(!a)throw Error("getOldPreviousSibling requested on invalid node.");return a.oldPrevious.get(t)},t.prototype.getOldAttribute=function(t,e){var r=this.treeChanges.get(t);if(!r||!r.attributes)throw Error("getOldAttribute requested on invalid node.");var a=r.getAttributeOldValue(e);if(void 0===a)throw Error("getOldAttribute requested for unchanged attribute name.");return a},t.prototype.attributeChangedNodes=function(t){if(!this.treeChanges.anyAttributesChanged)return{};var e,r;if(t){e={},r={};for(var a=0;a<t.length;a++){var i=t[a];e[i]=!0,r[i.toLowerCase()]=i}}for(var n={},o=this.treeChanges.keys(),a=0;a<o.length;a++){var s=o[a],h=this.treeChanges.get(s);if(h.attributes&&Movement.STAYED_IN===this.treeChanges.reachabilityChange(s)&&Movement.STAYED_IN===this.matchabilityChange(s))for(var u=s,c=h.getAttributeNamesMutated(),d=0;d<c.length;d++){var i=c[d];if(!e||e[i]||h.isCaseInsensitive&&r[i]){var l=h.getAttributeOldValue(i);l!==u.getAttribute(i)&&(r&&h.isCaseInsensitive&&(i=r[i]),n[i]=n[i]||[],n[i].push(u))}}}return n},t.prototype.getOldCharacterData=function(t){var e=this.treeChanges.get(t);if(!e||!e.characterData)throw Error("getOldCharacterData requested on invalid node.");return e.characterDataOldValue},t.prototype.getCharacterDataChanged=function(){if(!this.treeChanges.anyCharacterDataChanged)return[];for(var t=this.treeChanges.keys(),e=[],r=0;r<t.length;r++){var a=t[r];if(Movement.STAYED_IN===this.treeChanges.reachabilityChange(a)){var i=this.treeChanges.get(a);i.characterData&&a.textContent!=i.characterDataOldValue&&e.push(a)}}return e},t.prototype.computeMatchabilityChange=function(t,e){this.matchCache||(this.matchCache=[]),this.matchCache[t.uid]||(this.matchCache[t.uid]=new NodeMap);var r=this.matchCache[t.uid],a=r.get(e);return void 0===a&&(a=t.matchabilityChange(e,this.treeChanges.get(e)),r.set(e,a)),a},t.prototype.matchabilityChange=function(t){var e=this;if(this.characterDataOnly)switch(t.nodeType){case Node.COMMENT_NODE:case Node.TEXT_NODE:return Movement.STAYED_IN;default:return Movement.STAYED_OUT}if(!this.selectors)return Movement.STAYED_IN;if(t.nodeType!==Node.ELEMENT_NODE)return Movement.STAYED_OUT;for(var r=t,a=this.selectors.map(function(t){return e.computeMatchabilityChange(t,r)}),i=Movement.STAYED_OUT,n=0;i!==Movement.STAYED_IN&&n<a.length;){switch(a[n]){case Movement.STAYED_IN:i=Movement.STAYED_IN;break;case Movement.ENTERED:i=i===Movement.EXITED?Movement.STAYED_IN:Movement.ENTERED;break;case Movement.EXITED:i=i===Movement.ENTERED?Movement.STAYED_IN:Movement.EXITED}n++}return i},t.prototype.getChildlistChange=function(t){var e=this.childListChangeMap.get(t);return e||(e=new ChildListChange,this.childListChangeMap.set(t,e)),e},t.prototype.processChildlistChanges=function(){function t(t,e){!t||a.oldPrevious.has(t)||a.added.has(t)||a.maybeMoved.has(t)||e&&(a.added.has(e)||a.maybeMoved.has(e))||a.oldPrevious.set(t,e)}if(!this.childListChangeMap){this.childListChangeMap=new NodeMap;for(var e=0;e<this.mutations.length;e++){var r=this.mutations[e];if("childList"==r.type&&(this.treeChanges.reachabilityChange(r.target)===Movement.STAYED_IN||this.calcOldPreviousSibling)){for(var a=this.getChildlistChange(r.target),i=r.previousSibling,n=0;n<r.removedNodes.length;n++){var o=r.removedNodes[n];t(o,i),a.added.has(o)?a.added["delete"](o):(a.removed.set(o,!0),a.maybeMoved["delete"](o)),i=o}t(r.nextSibling,i);for(var n=0;n<r.addedNodes.length;n++){var o=r.addedNodes[n];a.removed.has(o)?(a.removed["delete"](o),a.maybeMoved.set(o,!0)):a.added.set(o,!0)}}}}},t.prototype.wasReordered=function(t){function e(t){if(!t)return!1;if(!o.maybeMoved.has(t))return!1;var e=o.moved.get(t);return void 0!==e?e:(s.has(t)?e=!0:(s.set(t,!0),e=a(t)!==r(t)),s.has(t)?(s["delete"](t),o.moved.set(t,e)):e=o.moved.get(t),e)}function r(t){var a=h.get(t);if(void 0!==a)return a;for(a=o.oldPrevious.get(t);a&&(o.removed.has(a)||e(a));)a=r(a);return void 0===a&&(a=t.previousSibling),h.set(t,a),a}function a(t){if(u.has(t))return u.get(t);for(var r=t.previousSibling;r&&(o.added.has(r)||e(r));)r=r.previousSibling;return u.set(t,r),r}if(!this.treeChanges.anyParentsChanged)return!1;this.processChildlistChanges();var i=t.parentNode,n=this.treeChanges.get(t);n&&n.oldParentNode&&(i=n.oldParentNode);var o=this.childListChangeMap.get(i);if(!o)return!1;if(o.moved)return o.moved.get(t);o.moved=new NodeMap;var s=new NodeMap,h=new NodeMap,u=new NodeMap;return o.maybeMoved.keys().forEach(e),o.moved.get(t)},t}(),Summary=function(){function t(t,e){var r=this;if(this.projection=t,this.added=[],this.removed=[],this.reparented=e.all||e.element||e.characterData?[]:void 0,this.reordered=e.all?[]:void 0,t.getChanged(this,e.elementFilter,e.characterData),e.all||e.attribute||e.attributeList){var a=e.attribute?[e.attribute]:e.attributeList,i=t.attributeChangedNodes(a);e.attribute?this.valueChanged=i[e.attribute]||[]:(this.attributeChanged=i,e.attributeList&&e.attributeList.forEach(function(t){r.attributeChanged.hasOwnProperty(t)||(r.attributeChanged[t]=[])}))}if(e.all||e.characterData){var n=t.getCharacterDataChanged();e.characterData?this.valueChanged=n:this.characterDataChanged=n}this.reordered&&(this.getOldPreviousSibling=t.getOldPreviousSibling.bind(t))}return t.prototype.getOldParentNode=function(t){return this.projection.getOldParentNode(t)},t.prototype.getOldAttribute=function(t,e){return this.projection.getOldAttribute(t,e)},t.prototype.getOldCharacterData=function(t){return this.projection.getOldCharacterData(t)},t.prototype.getOldPreviousSibling=function(t){return this.projection.getOldPreviousSibling(t)},t}(),validNameInitialChar=/[a-zA-Z_]+/,validNameNonInitialChar=/[a-zA-Z0-9_\-]+/,Qualifier=function(){function t(){}return t.prototype.matches=function(t){if(null===t)return!1;if(void 0===this.attrValue)return!0;if(!this.contains)return this.attrValue==t;for(var e=t.split(" "),r=0;r<e.length;r++)if(this.attrValue===e[r])return!0;return!1},t.prototype.toString=function(){return"class"===this.attrName&&this.contains?"."+this.attrValue:"id"!==this.attrName||this.contains?this.contains?"["+this.attrName+"~="+escapeQuotes(this.attrValue)+"]":"attrValue"in this?"["+this.attrName+"="+escapeQuotes(this.attrValue)+"]":"["+this.attrName+"]":"#"+this.attrValue},t}(),Selector=function(){function t(){this.uid=t.nextUid++,this.qualifiers=[]}return Object.defineProperty(t.prototype,"caseInsensitiveTagName",{get:function(){return this.tagName.toUpperCase()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectorString",{get:function(){return this.tagName+this.qualifiers.join("")},enumerable:!0,configurable:!0}),t.prototype.isMatching=function(e){return e[t.matchesSelector](this.selectorString)},t.prototype.wasMatching=function(t,e,r){if(!e||!e.attributes)return r;var a=e.isCaseInsensitive?this.caseInsensitiveTagName:this.tagName;if("*"!==a&&a!==t.tagName)return!1;for(var i=[],n=!1,o=0;o<this.qualifiers.length;o++){var s=this.qualifiers[o],h=e.getAttributeOldValue(s.attrName);i.push(h),n=n||void 0!==h}if(!n)return r;for(var o=0;o<this.qualifiers.length;o++){var s=this.qualifiers[o],h=i[o];if(void 0===h&&(h=t.getAttribute(s.attrName)),!s.matches(h))return!1}return!0},t.prototype.matchabilityChange=function(t,e){var r=this.isMatching(t);return r?this.wasMatching(t,e,r)?Movement.STAYED_IN:Movement.ENTERED:this.wasMatching(t,e,r)?Movement.EXITED:Movement.STAYED_OUT},t.parseSelectors=function(e){function r(){i&&(n&&(i.qualifiers.push(n),n=void 0),s.push(i)),i=new t}function a(){n&&i.qualifiers.push(n),n=new Qualifier}for(var i,n,o,s=[],h=/\s/,u="Invalid or unsupported selector syntax.",c=1,d=2,l=3,v=4,f=5,p=6,g=7,b=8,m=9,C=10,E=11,y=12,N=13,M=14,O=c,D=0;D<e.length;){var w=e[D++];switch(O){case c:if(w.match(validNameInitialChar)){r(),i.tagName=w,O=d;break}if("*"==w){r(),i.tagName="*",O=l;break}if("."==w){r(),a(),i.tagName="*",n.attrName="class",n.contains=!0,O=v;break}if("#"==w){r(),a(),i.tagName="*",n.attrName="id",O=v;break}if("["==w){r(),a(),i.tagName="*",n.attrName="",O=p;break}if(w.match(h))break;throw Error(u);case d:if(w.match(validNameNonInitialChar)){i.tagName+=w;break}if("."==w){a(),n.attrName="class",n.contains=!0,O=v;break}if("#"==w){a(),n.attrName="id",O=v;break}if("["==w){a(),n.attrName="",O=p;break}if(w.match(h)){O=M;break}if(","==w){O=c;break}throw Error(u);case l:if("."==w){a(),n.attrName="class",n.contains=!0,O=v;break}if("#"==w){a(),n.attrName="id",O=v;break}if("["==w){a(),n.attrName="",O=p;break}if(w.match(h)){O=M;break}if(","==w){O=c;break}throw Error(u);case v:if(w.match(validNameInitialChar)){n.attrValue=w,O=f;break}throw Error(u);case f:if(w.match(validNameNonInitialChar)){n.attrValue+=w;break}if("."==w){a(),n.attrName="class",n.contains=!0,O=v;break}if("#"==w){a(),n.attrName="id",O=v;break}if("["==w){a(),O=p;break}if(w.match(h)){O=M;break}if(","==w){O=c;break}throw Error(u);case p:if(w.match(validNameInitialChar)){n.attrName=w,O=g;break}if(w.match(h))break;throw Error(u);case g:if(w.match(validNameNonInitialChar)){n.attrName+=w;break}if(w.match(h)){O=b;break}if("~"==w){n.contains=!0,O=m;break}if("="==w){n.attrValue="",O=E;break}if("]"==w){O=l;break}throw Error(u);case b:if("~"==w){n.contains=!0,O=m;break}if("="==w){n.attrValue="",O=E;break}if("]"==w){O=l;break}if(w.match(h))break;throw Error(u);case m:if("="==w){n.attrValue="",O=E;break}throw Error(u);case C:if("]"==w){O=l;break}if(w.match(h))break;throw Error(u);case E:if(w.match(h))break;if('"'==w||"'"==w){o=w,O=N;break}n.attrValue+=w,O=y;break;case y:if(w.match(h)){O=C;break}if("]"==w){O=l;break}if("'"==w||'"'==w)throw Error(u);n.attrValue+=w;break;case N:if(w==o){O=C;break}n.attrValue+=w;break;case M:if(w.match(h))break;if(","==w){O=c;break}throw Error(u)}}switch(O){case c:case d:case l:case f:case M:r();break;default:throw Error(u)}if(!s.length)throw Error(u);return s},t.nextUid=1,t.matchesSelector=function(){var t=document.createElement("div");return"function"==typeof t.webkitMatchesSelector?"webkitMatchesSelector":"function"==typeof t.mozMatchesSelector?"mozMatchesSelector":"function"==typeof t.msMatchesSelector?"msMatchesSelector":"matchesSelector"}(),t}(),attributeFilterPattern=/^([a-zA-Z:_]+[a-zA-Z0-9_\-:\.]*)$/,MutationSummary=function(){function t(e){var r=this;this.connected=!1,this.options=t.validateOptions(e),this.observerOptions=t.createObserverOptions(this.options.queries),this.root=this.options.rootNode,this.callback=this.options.callback,this.elementFilter=Array.prototype.concat.apply([],this.options.queries.map(function(t){return t.elementFilter?t.elementFilter:[]})),this.elementFilter.length||(this.elementFilter=void 0),this.calcReordered=this.options.queries.some(function(t){return t.all}),this.queryValidators=[],t.createQueryValidator&&(this.queryValidators=this.options.queries.map(function(e){return t.createQueryValidator(r.root,e)})),this.observer=new MutationObserverCtor(function(t){r.observerCallback(t)}),this.reconnect()}return t.createObserverOptions=function(t){function e(t){if(!a.attributes||r){if(a.attributes=!0,a.attributeOldValue=!0,!t)return void(r=void 0);r=r||{},t.forEach(function(t){r[t]=!0,r[t.toLowerCase()]=!0})}}var r,a={childList:!0,subtree:!0};return t.forEach(function(t){if(t.characterData)return a.characterData=!0,void(a.characterDataOldValue=!0);if(t.all)return e(),a.characterData=!0,void(a.characterDataOldValue=!0);if(t.attribute)return void e([t.attribute.trim()]);var r=elementFilterAttributes(t.elementFilter).concat(t.attributeList||[]);r.length&&e(r)}),r&&(a.attributeFilter=Object.keys(r)),a},t.validateOptions=function(e){for(var r in e)if(!(r in t.optionKeys))throw Error("Invalid option: "+r);if("function"!=typeof e.callback)throw Error("Invalid options: callback is required and must be a function");if(!e.queries||!e.queries.length)throw Error("Invalid options: queries must contain at least one query request object.");for(var a={callback:e.callback,rootNode:e.rootNode||document,observeOwnChanges:!!e.observeOwnChanges,oldPreviousSibling:!!e.oldPreviousSibling,queries:[]},i=0;i<e.queries.length;i++){var n=e.queries[i];if(n.all){if(Object.keys(n).length>1)throw Error("Invalid request option. all has no options.");a.queries.push({all:!0})}else if("attribute"in n){var o={attribute:validateAttribute(n.attribute)};if(o.elementFilter=Selector.parseSelectors("*["+o.attribute+"]"),Object.keys(n).length>1)throw Error("Invalid request option. attribute has no options.");a.queries.push(o)}else if("element"in n){var s=Object.keys(n).length,o={element:n.element,elementFilter:Selector.parseSelectors(n.element)};if(n.hasOwnProperty("elementAttributes")&&(o.attributeList=validateElementAttributes(n.elementAttributes),s--),s>1)throw Error("Invalid request option. element only allows elementAttributes option.");a.queries.push(o)}else{if(!n.characterData)throw Error("Invalid request option. Unknown query request.");if(Object.keys(n).length>1)throw Error("Invalid request option. characterData has no options.");a.queries.push({characterData:!0})}}return a},t.prototype.createSummaries=function(t){if(!t||!t.length)return[];for(var e=new MutationProjection(this.root,t,this.elementFilter,this.calcReordered,this.options.oldPreviousSibling),r=[],a=0;a<this.options.queries.length;a++)r.push(new Summary(e,this.options.queries[a]));return r},t.prototype.checkpointQueryValidators=function(){this.queryValidators.forEach(function(t){t&&t.recordPreviousState()})},t.prototype.runQueryValidators=function(t){this.queryValidators.forEach(function(e,r){e&&e.validate(t[r])})},t.prototype.changesToReport=function(t){return t.some(function(t){var e=["added","removed","reordered","reparented","valueChanged","characterDataChanged"];if(e.some(function(e){return t[e]&&t[e].length}))return!0;if(t.attributeChanged){var r=Object.keys(t.attributeChanged),a=r.some(function(e){return!!t.attributeChanged[e].length});if(a)return!0}return!1})},t.prototype.observerCallback=function(t){this.options.observeOwnChanges||this.observer.disconnect();var e=this.createSummaries(t);this.runQueryValidators(e),this.options.observeOwnChanges&&this.checkpointQueryValidators(),this.changesToReport(e)&&this.callback(e),!this.options.observeOwnChanges&&this.connected&&(this.checkpointQueryValidators(),this.observer.observe(this.root,this.observerOptions))},t.prototype.reconnect=function(){if(this.connected)throw Error("Already connected");this.observer.observe(this.root,this.observerOptions),this.connected=!0,this.checkpointQueryValidators()},t.prototype.takeSummaries=function(){if(!this.connected)throw Error("Not connected");var t=this.createSummaries(this.observer.takeRecords());return this.changesToReport(t)?t:void 0},t.prototype.disconnect=function(){var t=this.takeSummaries();return this.observer.disconnect(),this.connected=!1,t},t.NodeMap=NodeMap,t.parseElementFilter=Selector.parseSelectors,t.optionKeys={callback:!0,queries:!0,rootNode:!0,oldPreviousSibling:!0,observeOwnChanges:!0},t}();!function(t,e){"use strict";var r="JqueryMutationSummary",a=function(e,r){this.$element=t(e),this.options=t.extend(!0,{},this.internalDefaults,t.fn.mutationSummary.defaults,r)},i=function(t,e){this.$element=t,this.configuration=e},n={};t.extend(!0,n,{getConfiguration:function(e,r,a){var i;return t.isFunction(e)?(t.isArray(r)&&(a=r,r=!1),i={callback:e,observeOwnChanges:r===!0,queries:a||[]}):i=e,i}}),a.prototype={constructor:a,internalDefaults:{mutationSummaries:[]},connect:function(t,e,r){var a=n.getConfiguration(t,e,r),o=new i(this.$element,a);this.options.mutationSummaries.push(o),o.start()},disconnect:function(e,r,a){var i=this.options.mutationSummaries;t.each(i,function(t){void 0!==this&&this.configurationMatches(e,r,a)&&(this.stop(),delete i[t])})}},i.prototype={constructor:i,getCallbackWrapper:function(){function e(e){e.observer=this.observer,e.configuration=t.extend(!0,{},this.configuration),this.originalCallback(e)}return t.proxy(e,this)},configurationMatches:function(t,e,r){var a=n.getConfiguration(t,e,r),i=!0;return i=i&&(void 0===t||this.configuration.callback===a.callback),i=i&&(void 0===e||this.configuration.observeOwnChanges===a.observeOwnChanges),i=i&&(void 0===r||this.configuration.queries===a.queries)},start:function(){var r=this.$element.get(0);this.originalCallback=this.configuration.callback,this.wrappedCallback=this.getCallbackWrapper(),this.wrappedConfiguration=t.extend(!0,{},this.configuration),1===this.$element.length&&r!==e&&(this.wrappedConfiguration.rootNode=r),this.wrappedConfiguration.callback=this.wrappedCallback,this.observer=new MutationSummary(this.wrappedConfiguration)},stop:function(){var t=this.observer.disconnect();void 0!==t&&this.wrappedCallback(t),delete this.observer}},t.fn.extend({mutationSummary:function(e){var i=arguments;return this.each(function(){var n=t(this),o=n.data(r),s="object"==typeof e&&e;o||n.data(r,o=new a(this,s)),"string"==typeof e&&o[e].apply(o,Array.prototype.slice.call(i,1))})}}),t.fn.mutationSummary.defaults={},t.fn.mutationSummary.Constructor=a}(jQuery,this);